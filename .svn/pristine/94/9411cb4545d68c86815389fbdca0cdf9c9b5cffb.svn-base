var cityListManager = {
	delUrl : "./background/other/delCity",
	subUrl : "./background/other/addCity",
	init : function(){
		$(window).load(function(){
			$('#bankListGid').datagrid({
				url:'./background/other/cityMessageList.json',
				border:false,
				fit:true,
				singleSelect:true,
				idField:'id',
				pagination:true,
				pageSize:20,
				striped:true,
				fitColumns:true,
				columns : [ [ {
					field : 'id',
					title : 'id',
					align:'center',width:0,hidden:true

				},{
					field : 'cityName',
					title : '城市名称',
					align:'center',width:40
				},{
					field : 'cityNameEn',
					title : '城市名称拼音',
					align:'center',width:40
				},{
					field : 'cityShortNameEn',
					title : '城市拼音首字母',
					align:'center',width:40
				},{
					field : 'cityType',
					title : '国内(外)',
					align:'center',width:40,formatter: function(value,row,index){
						if (row.cityType==1){
							return '国内';
						} else {
							return '国外';
						}
					}
				},{
					field : 'cityHot',
					title : '热门城市',
					align:'center',width:40,formatter: function(value,row,index){
						if (row.cityHot==1){
							return '是';
						}else{
							return '否';
						}
					}
				}] ]
			});
		
		});
	},	
	del : function(){
		var row=$('#bankListGid').datagrid('getSelected');
		if(!row){
			eu.showMsg("请选择一行信息");
			return;
		}
		$.messager.confirm("提示信息","您确定要删除所选数据吗？,删除后不可恢复!",function(r){
			if(r){
				$.post(cityListManager.delUrl,{id : row.id })
				.success(function(data){
								if(data.success){
									eu.showMsg("删除成功！");
									$("#bankListGid").datagrid('reload');
								}else{
									eu.showMsg(data);
								}
							}
						).error(function(data){
				        	eu.showMsg("系统错误，请联系管理员！");
				        })
			}else{
				$('#bankListGid').datagrid('clearSelections');
			}
			});
	},
	serch : function () {
 		var cityName = $('#searchValue1').val();
 		$('#bankListGid').datagrid('load',{cityName: cityName});
		$('#bankListGid').datagrid('clearSelections');
		
	},
	add : function(){
		$('#bankWindow').window('open');
		$('#bankForm').form('clear');
		$('#id').val(0);
	},
	edit : function(){
		var row=$('#bankListGid').datagrid('getSelected');
		if(!row){
			eu.showMsg("请选择一行信息");
			return;
		}
		$('#bankWindow').window('open');
		$('#id').val(row.id);
		console.log(row);
		$('#cityName').val(row.cityName);
		$('#cityNameEn').val(row.cityNameEn);
		$('#cityShortNameEn').val(row.cityShortNameEn);
		$('#cityType').val(row.cityType);
		$('#cityHot').val(row.cityHot);
		$('#id').val(row.id);
	},
	clearForm:function(){
		$('#bankForm').form('clear');
	},
	cancel:function(){
		$('#bankForm').form('clear');
		$('#bankWindow').window('close');
	},
	addSub : function() {
		var a = cityListManager.subUrl;
		
		var formElement = document.getElementById("cityForm");
		var oReq = new XMLHttpRequest();
		$.messager.progress({
			title : '提示信息',
			msg : '请稍候...',
			interval : 2000
		});
		oReq.open("POST", a, true);
		oReq.send(new FormData(formElement));
		oReq.onreadystatechange = function() {
			if (oReq.readyState == 4) {
				console.log(oReq.status);
				if (oReq.status == 200) {
					var b = oReq.responseText;
					console.log(b);
					if (b == "success") {
						$.messager.progress('close');
						$('#bankWindow').window('close');
						$('#bankListGid').datagrid('reload');
					} else {
						$.messager.progress('close');
						eu.showMsg("失败");
					}
				} else {
					$.messager.progress('close');
					eu.showMsg("失败");
				}
			}
		}
	}
};
cityListManager.init();