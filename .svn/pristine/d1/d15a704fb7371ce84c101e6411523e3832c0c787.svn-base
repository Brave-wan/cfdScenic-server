var bankListManager = {
	delUrl : "./background/other/delBank",
	subUrl : "./background/other/subBank",
	subUrl1 : "./background/other/subBank1",
	init : function(){
		$(window).load(function(){
			$('#bankListGid').datagrid({
				url:'./background/other/bankListData.json',
				border:false,
				fit:true,
				singleSelect:true,
				idField:'id',
				pagination:true,
				pageSize:20,
				striped:true,
				fitColumns:true,
				columns : [ [ {
					field : 'id',
					title : 'id',
					align:'center',width:100,hidden:true

				},{
					field : 'bankName',
					title : '银行名',
					align:'center',width:100
				},{
					field : 'imageUrl',
					title : '图标',
					align:'center',width:100,
					formatter : function(v, r, i) {
						return  '<img src='+v+' alt="图片暂时无法显示" width="40px" height="40px"/>';
					}
				}] ]
			});
		
		});
	},	
	del : function(){
		var row=$('#bankListGid').datagrid('getSelected');
		if(!row){
			eu.showMsg("请选择一行信息");
			return;
		}
		$.messager.confirm("提示信息","您确定要删除所选数据吗？,删除后不可恢复!",function(r){
			if(r){
				$.post(bankListManager.delUrl,{id : row.id })
				.success(function(data){
								if(data.success){
									eu.showMsg("删除成功！");
									$("#bankListGid").datagrid('reload');
								}else{
									eu.showMsg(data);
								}
							}
						).error(function(data){
				        	eu.showMsg("系统错误，请联系管理员！");
				        })
			}else{
				$('#bankListGid').datagrid('clearSelections');
			}
			});
	},
	serch : function () {
 		var bankName = $('#searchValue1').val();
 		$('#bankListGid').datagrid('load',{bankName: bankName});
		$('#bankListGid').datagrid('clearSelections');
		
	},
	add : function(){
		$('#bankWindow').window('open');
		$('#bankForm').form('clear');
		$('#id').val(0);
	},
	edit : function(){
		var row=$('#bankListGid').datagrid('getSelected');
		if(!row){
			eu.showMsg("请选择一行信息");
			return;
		}
		$('#bankWindow').window('open');
		$('#id').val(row.id);
		console.log(row);
		$('#bankName').val(row.bankName);
	},
	clearForm:function(){
		$('#bankForm').form('clear');
	},
	cancel:function(){
		$('#bankForm').form('clear');
		$('#bankWindow').window('close');
	},
	addSub : function() {
		var a = bankListManager.subUrl;
		if($('#imgFile').val() == null || $('#imgFile').val() == ''){
			a = bankListManager.subUrl1;
		}
		var formElement = document.getElementById("bankForm");
		var oReq = new XMLHttpRequest();
		$.messager.progress({
			title : '提示信息',
			msg : '请稍候...',
			interval : 2000
		});
		oReq.open("POST", a, true);
		oReq.send(new FormData(formElement));
		oReq.onreadystatechange = function() {
			if (oReq.readyState == 4) {
				console.log(oReq.status);
				if (oReq.status == 200) {
					var b = oReq.responseText;
					console.log(b);
					if (b == "success") {
						$.messager.progress('close');
						$('#bankWindow').window('close');
						$('#bankListGid').datagrid('reload');
					} else {
						$.messager.progress('close');
						eu.showMsg("失败");
					}
				} else {
					$.messager.progress('close');
					eu.showMsg("失败");
				}
			}
		}
	}
};
bankListManager.init();