<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.htkj.cfdScenic.app.dao.UserAccountDao">

	<select id="getRemainingPoints" resultType="INTEGER" parameterType="long">
		select integration from user_account where user_id=#{userId}
	</select>
	<select id="getMyBalance" parameterType="long" resultType="map">
		select
			id,
			balance,
			user_id
		from 
			user_account
		where
			user_id = #{userId,jdbcType=NUMERIC}	
	</select>
	<select id="getMyIntegral" parameterType="long" resultType="map">
		select
			id,
			integration,
			user_id
		from 
			user_account
		where
			user_id = #{userId,jdbcType=NUMERIC}	
	</select>
	<update id="updateBalanceUserAccount" parameterType="map">
		update user_account set	balance = #{balance}
			<if test="integration!='' and integration!=null">
				, integration = integration + #{integration}
			</if> 
		where user_id = #{userId} 
	</update>
	<update id="updateCutDowmBalanceUserAccount" parameterType="map">
		update user_account set balance = #{balance} where user_id = #{userId}
	</update>
	
	<update id="updateBalanceShopToUser" parameterType="map">
		update user_account ua set ua.balance = ua.balance + #{balance}  where ua.id = #{balanceId} 
	</update> 
	
	<update id="updateMoney" parameterType="map">
		update user_account set integration = #{integral}
			<if test="balance != '' and balance != null">
				, balance = #{balance}
			</if>
		where user_id = #{userId}
	</update>
	
	<select id="findByUserId" parameterType="long" resultType="com.htkj.cfdScenic.app.model.UserAccount">
		select id,user_id as userId,balance,integration from user_account where user_id = #{userId,jdbcType=NUMERIC}	
	</select>
	
	
	<update id="updateBalanceMessage" parameterType="com.htkj.cfdScenic.app.model.UserAccount">
		update user_account set balance = #{balance},integration = integration + #{integration} where user_id = #{userId}
	</update>
	<update id="updateBalanceByShopUserId" parameterType="com.htkj.cfdScenic.app.model.UserAccount">
		update user_account set balance = #{balance} where user_id = #{userId}
	</update>
	<insert id="insertUserAccount" parameterType="com.htkj.cfdScenic.app.model.UserAccount">
		insert into user_account(id,user_id,balance,integration)values(#{id},#{userId},#{balance},#{integration})
	</insert>
	<update id="updateUserAccountByUserId" parameterType="map">
		update user_account set balance = #{balance},integration = #{integration} where userId = #{userId}
	</update>
	<select id="getUserAccount" parameterType="long" resultType="double">
		select
			balance
		from 
			user_account
		where
			user_id = #{userId}
	</select>
	<select id="getIntegrationByUserId" parameterType="long" resultType="int">
		select
			IFNULL(integration,0) as integration 
		from 
			user_account
		where
			user_id = #{userId}
	</select>
	<update id="updateAccountByMap" parameterType="map">
		update user_account set 
			integration = integration + #{integration} 
			<if test="balance != null and balance != ''">
			, balance = #{balance}
			</if>	
		where user_id = #{userId}
	</update>
</mapper>