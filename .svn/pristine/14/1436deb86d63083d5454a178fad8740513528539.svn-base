<%@ page contentType="text/html; charset=UTF-8" trimDirectiveWhitespaces="true"%>
<%@ include file="/WEB-INF/views-commons/header.jsp"%>
<link rel="stylesheet" href="http://cache.amap.com/lbs/static/main1119.css" />
<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=2f589c0f0d80857dbac2b0b4d36acbfb&plugin=AMap.Autocomplete"></script>
<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=2f589c0f0d80857dbac2b0b4d36acbfb&plugin=AMap.ToolBar"></script>
<script type="text/javascript" src="http://cache.amap.com/lbs/static/addToolbar.js"></script>
<style type="text/css">
	body{font-family: "微软雅黑";}
	table{width:90%;margin:20px auto;}
	table td{height:45px;text-align:left;}
	table td:first-child{width:10%;}
	table td:last-child{width:90%;}
	table td input[type=text]{width:80%;height:30px;line-height: 30px;padding-left: 10px;}
	table img{width:150px;height:100px;}
	table td textarea{padding-left:10px;}
	table td label{float: left;width:100px;text-align: left;}
	.l-btn-text{line-height: 30px;}
	.easyui-linkbutton{width:30%;height:30px;display: inline-block;}

    .uploader { position:relative; display:inline-block; overflow:hidden; cursor:default; padding:0; margin:10px 0px; -moz-box-shadow:0px 0px 5px #ddd; -webkit-box-shadow:0px 0px 5px #ddd; box-shadow:0px 0px 5px #ddd; -moz-border-radius:5px; -webkit-border-radius:5px; border-radius:5px; }
    #filename { float:left; display:inline-block; outline:0 none; height:32px; width:180px; margin:0; padding:8px 10px; overflow:hidden; cursor:default; border:1px solid; border-right:0; font:9pt/100% Arial, Helvetica, sans-serif; color:#777; text-shadow:1px 1px 0px #fff; text-overflow:ellipsis; white-space:nowrap; -moz-border-radius:5px 0px 0px 5px; -webkit-border-radius:5px 0px 0px 5px; border-radius:5px 0px 0px 5px; background:#f5f5f5; background:-moz-linear-gradient(top, #fafafa 0%, #eee 100%); background:-webkit-gradient(linear, left top, left bottom, color-stop(0%, #fafafa), color-stop(100%, #f5f5f5)); filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#fafafa', endColorstr='#f5f5f5', GradientType=0);
        border-color:#ccc; -moz-box-shadow:0px 0px 1px #fff inset; -webkit-box-shadow:0px 0px 1px #fff inset; box-shadow:0px 0px 1px #fff inset; -moz-box-sizing:border-box; -webkit-box-sizing:border-box; box-sizing:border-box; }
    .button { float:left; height:32px; display:inline-block; outline:0 none; padding:8px 12px; margin:0; cursor:pointer; border:1px solid; font:bold 9pt/100% Arial, Helvetica, sans-serif; -moz-border-radius:0px 5px 5px 0px; -webkit-border-radius:0px 5px 5px 0px; border-radius:0px 5px 5px 0px; -moz-box-shadow:0px 0px 1px #fff inset; -webkit-box-shadow:0px 0px 1px #fff inset; box-shadow:0px 0px 1px #fff inset; }
    .uploader input[type=file] { position:absolute; top:0; right:0; bottom:0; border:0; padding:0; margin:0; height:30px; cursor:pointer; filter:alpha(opacity=0); -moz-opacity:0; -khtml-opacity: 0; opacity:0; }
    input[type=button]::-moz-focus-inner {
        padding:0;
        border:0 none;
        -moz-box-sizing:content-box;
    }
    input[type=button]::-webkit-focus-inner {
        padding:0;
        border:0 none;
        -webkit-box-sizing:content-box;
    }
    input[type=text]::-moz-focus-inner {
        padding:0;
        border:0 none;
        -moz-box-sizing:content-box;
    }
    input[type=text]::-webkit-focus-inner {
        padding:0;
        border:0 none;
        -webkit-box-sizing:content-box;
    }
    /* White Color Scheme ------------------------ */

    .white .button { color:#555; text-shadow:1px 1px 0px #fff; background:#ddd; background:-moz-linear-gradient(top, #eeeeee 0%, #dddddd 100%); background:-webkit-gradient(linear, left top, left bottom, color-stop(0%, #eeeeee), color-stop(100%, #dddddd)); filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#eeeeee', endColorstr='#dddddd', GradientType=0);
        border-color:#ccc; }
    .white:hover .button { background:#eee; background:-moz-linear-gradient(top, #dddddd 0%, #eeeeee 100%); background:-webkit-gradient(linear, left top, left bottom, color-stop(0%, #dddddd), color-stop(100%, #eeeeee)); filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#dddddd', endColorstr='#eeeeee', GradientType=0);
    }
    /* Blue Color Scheme ------------------------ */

    .blue .button { color:#fff; text-shadow:1px 1px 0px #09365f; background:#064884; background:-moz-linear-gradient(top, #3b75b4 0%, #064884 100%); background:-webkit-gradient(linear, left top, left bottom, color-stop(0%, #3b75b4), color-stop(100%, #064884)); filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#3b75b4', endColorstr='#064884', GradientType=0);
        border-color:#09365f; }
    .blue:hover .button { background:#3b75b4; background:-moz-linear-gradient(top, #064884 0%, #3b75b4 100%); background:-webkit-gradient(linear, left top, left bottom, color-stop(0%, #064884), color-stop(100%, #3b75b4)); filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#064884', endColorstr='#3b75b4', GradientType=0);
    }
    #initMap {
        width: 100%;
        height: 100%;
        font-size: 12px;
        font-family: "微软雅黑";
    }
</style>
<div style="width:98.5%;padding:10px;">
        <c:if test="${type==1}">
            <div style="padding:8px 2px;border-bottom:1px solid #ccc">当前位置:景点管理-添加景点</div>
        </c:if><c:if test="${type==2}">
            <div style="padding:8px 2px;border-bottom:1px solid #ccc">当前位置:景点管理-添加基础活动</div>
        </c:if><c:if test="${type==3}">
            <div style="padding:8px 2px;border-bottom:1px solid #ccc">当前位置:景点管理-添加结伴游活动</div>
        </c:if><c:if test="${type==4}">
            <div style="padding:8px 2px;border-bottom:1px solid #ccc">当前位置:景点管理-添加积分商品</div>
        </c:if><c:if test="${type==5}">
            <div style="padding:8px 2px;border-bottom:1px solid #ccc">当前位置:景点管理-添加积分门票</div>
        </c:if>

			<form id="ff" action="./background/visitorsManage/addVisitors" method="post" enctype="multipart/form-data">
                <input type="hidden" value="${type}" id="tId"/>
				<table>
					<tr>
						<td>名称：</td>
						<td><input type="text" id="name" name="name" placeholder="请输入名称"/></td>
					</tr>
                    <tr>
                        <td>英文名称：</td>
                        <td><input type="text" id="nameEn" name="nameEn" placeholder="请输入英文名称" /></td>
                    </tr>
					<tr>
						<td>简介：</td>
						<td><input type="text" id="visitorsDescribe" name="visitorsDescribe" placeholder="请输入简介" /></td>
					</tr>
					<tr>
						<td>原价：</td>
						<td><input type="text" id="price" name="price" onkeyup="this.value=this.value.replace(/[^0-9]/g,'')" onafterpaste="this.value=this.value.replace(/[^0-9]/g,'')" placeholder="请输入原价" /></td>
					</tr>
					<tr>
						<td>折后价：</td>
						<td><input type="text" id="newPrice" name="newPrice" onkeyup="this.value=this.value.replace(/[^0-9]/g,'')" onafterpaste="this.value=this.value.replace(/[^0-9]/g,'')"  placeholder="请输入折后价"/></td>
					</tr>
					<tr>
						<td>地址：</td>
						<td><input type="text" id="address" name="address" placeholder="请输入地址" /></td>
					</tr>
					<tr>
						<td>经度：</td>
						<td><input type="text" name="latitude" id="latitude" onMouseUp="latAndLong()" readonly placeholder="请获取经度" /></td>
                        <td>
                            <div class="latAndLong" style="display:none">
                                <img style="width:auto;height:auto" src="${ctx}/images/dontUpdate.png" >
                            </div>
                        </td>
					</tr>
                    <tr>
                        <td>纬度：</td>
                        <td><input type="text" name="longitude" id="longitude" onMouseUp="latAndLong()" readonly placeholder="请获取纬度" /></td>
                        <td>
                            <div class="latAndLong" style="display:none">
                                <img style="width:auto;height:auto" src="${ctx}/images/dontUpdate.png" >
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>获取经纬度：</td>
                        <td>
                            <a href="javascript:void(0)" onclick="openNew()" class="easyui-linkbutton" iconCls="icon-add">点击获取经纬度</a>
                        </td>
                    </tr>

					<tr>
						<td>备注：</td>
						<td><input type="text" name="memo" placeholder="请输入备注" /></td>
					</tr>

                    <c:if test="${type==1}">
                        <input type="hidden" name="integral" value="0" placeholder="请输入积分" />
                    </c:if>
                    <c:if test="${type==2}">
                        <input type="hidden" name="integral" value="0" placeholder="请输入积分" />
                    </c:if>
                    <c:if test="${type==3}">
                        <input type="hidden" name="integral" value="0" placeholder="请输入积分" />
                    </c:if>
                    <c:if test="${type==4}">
                        <tr>
                            <td>积分：</td>
                            <td><input type="text" id="integral" name="integral" placeholder="请输入积分" /></td>
                        </tr>
                    </c:if>
                    <c:if test="${type==5}">
                        <tr>
                            <td>积分：</td>
                            <td><input type="text" id="integral" name="integral" placeholder="请输入积分" /></td>
                        </tr>
                    </c:if>
					<tr>
						<td>配送费：</td>
						<td><input type="text" id="deliverFee" name="deliverFee" onkeyup="this.value=this.value.replace(/[^0-9]/g,'')" onafterpaste="this.value=this.value.replace(/[^0-9]/g,'')" /></td>
					</tr>
                    <c:if test="${type==1}">
                        <tr>
                            <td>人数：</td>
                            <td><input type="text" id="number" name="number" /></td>
                        </tr>
                    </c:if>
                    <c:if test="${type==2}">
                        <tr>
                            <td>人数：</td>
                            <td><input type="text" id="number" name="number" /></td>
                        </tr>
                    </c:if>
                    <c:if test="${type==3}">
                        <tr>
                            <td>人数：</td>
                            <td><input type="text" id="number" name="number" /></td>
                        </tr>
                    </c:if>
                    <c:if test="${type==4}">
                        <input type="hidden" name="number" value="0" />
                    </c:if>
                    <c:if test="${type==5}">
                        <tr>
                            <td>人数：</td>
                            <td><input type="text" id="number" name="number" /></td>
                        </tr>
                    </c:if>
					<tr>
						<td>满意度：</td>
						<td>
                            <select id="select" name="satisfaction">
                                <option  value=''>请选择</option>
                                <option  value='0'>0</option>
                                <option  value='10%'>10%</option>
                                <option  value='20%'>20%</option>
                                <option  value='30%'>30%</option>
                                <option  value='40%'>40%</option>
                                <option  value='50%'>50%</option>
                                <option  value='60%'>60%</option>
                                <option  value='70%'>70%</option>
                                <option  value='80%'>80%</option>
                                <option  value='90%'>90%</option>
                                <option  value='100%'>100%</option>
                            </select>
                        </td>
					</tr>

					<tr>
						<td>类型：</td>
						<td>
						<select name="type" disabled id="typeId">
							<option value="1" <c:if test="${type==1}">selected</c:if> >景点</option>
							<option value="2" <c:if test="${type==2}">selected</c:if> >基础活动</option>
							<option value="3" <c:if test="${type==3}">selected</c:if> >结伴游活动</option>
							<option value="4" <c:if test="${type==4}">selected</c:if> >积分商品</option>
							<option value="5" <c:if test="${type==5}">selected</c:if> >积分门票</option>
						</select>
						</td>
					</tr>
                    <tr>
                        <td>是否推荐：</td>
                        <td>
                            <input type="radio" checked="checked" name="isRecommend" value="0">正常
                            <input type="radio" name="isRecommend" value="1">推荐
                        </td>
                    </tr>
                    <tr>
                        <td>状态：</td>
                        <td>
                            <input type="radio" checked="checked" name="state" value="0">正常
                            <input type="radio" name="state" value="1">删除
                        </td>
                    </tr>
                    <tr>
                        <td>开启时间：</td>
                        <td><input type="text" id="startValid" name="startValid" class="easyui-datebox" style="width: 150px;"/></td>
                    </tr>
                    <tr>
                        <td>关闭时间：</td>
                        <td><input type="text" id="endValid" name="endValid" class="easyui-datebox" style="width: 150px;"/></td>
                    </tr>
					<%--<tr>
						<td>规划：</td>
						<td><input type="text" name="planningId" /></td>
					</tr>
					<tr>
						<td>湿地简介：</td>
						<td><input type="text" name="introduceId" /></td>
					</tr>--%>
					<tr>
						<td>主图：</td>
						<td>
                            <div class="uploader blue">
                                <input type="text" id="filename" class="filename" readonly="">
                                <input type="button" name="imageFile" class="button" value="上传...">
                                <input type="file" size="30" name="imageFile" onchange="uploadImg()">
                            </div>
						</td>
					</tr>
                    <tr>
                        <td>主图展示：</td>
                        <td>
                            <div id="pictureId"></div>
                            <input type="hidden" id="pictureUrl" name="pictureUrl">
                        </td>
                    </tr>
                    <tr>
                        <td>须知：</td>
                        <td>
                            <script id="editor1" type="text/plain" style="width:1024px;height:500px;"></script>
                            <input type="hidden" name="noticeId" id="noticeId" />
                        </td>
                    </tr>
					<tr>
						<td>景区详情：</td>
						<td>
							<script id="editor2" type="text/plain" style="width:1024px;height:500px;"></script>
                            <input type="hidden" name="detailsId" id="detailsId" />

						</td>
					</tr>
				</table>
				<div style="text-align:center;padding:5px">
 					<a id="showPageSaveBtn" href="javascript:void(0)" onclick="save()" class="easyui-linkbutton" iconCls="icon-save">确定</a>
					<%--<a id="showPageCancleBtn" href="javascript:void(0)" onclick="window.location.href ='./background/visitorsManage/toVisitorsManage'" class="easyui-linkbutton" iconCls="icon-cancel">取消</a>--%>
					<a id="showPageCancleBtn" href="javascript:void(0)" onclick="history.go(-1)" class="easyui-linkbutton" iconCls="icon-cancel">取消</a>
			    </div>
			</form>
</div>
<div id="mapWindow" class="easyui-dialog" title="选择经纬度" data-options="closed:true,inline:true"
     style="width: 1000px; height: 500px; padding: 5px;">
    <div class="easyui-layout" data-options="fit:true">
        <div data-options="region:'center'" style="padding: 10px;">
            <div id="initMap" tabindex="0"></div>
            <div id="myPageTop" style="width: 400px; height: 40px;">
                <table style="width:90%;margin:0px;">
                    <tr>
                        <td style="width:25%;height:45px;text-align:left;">经度：</td>
                        <td style="height:25%;text-align:left;"><input style="width:100px;height:20px;line-height: 10px;padding-left: 10px;" type="text" id="lat"/></td>
                        <td style="width:25%;height:45px;text-align:left;">纬度：</td>
                        <td style="height:25%;text-align:left;"><input style="width:100px;height:20px;line-height: 10px;padding-left: 10px;" type="text" id="lon"/></td>
                    </tr>
                </table>
            </div>
        </div>

        <div data-options="region:'south',border:false" style="text-align: right; padding: 5px 0 0;">
            <a class="easyui-linkbutton" data-options="iconCls:'icon-ok'" href="javascript:void(0)" onclick="saveJW()">确定</a>
            <a class="easyui-linkbutton" data-options="iconCls:'icon-cancel'" href="javascript:void(0)" onclick="closeJW()">关闭</a>
        </div>
    </div>
</div>

<script type="text/javascript">

    $(function(){

        $("input[type=file]").change(function(){
            $(this).parents(".uploader").find(".filename").val($(this).val());
        });

        $("input[type=file]").each(function(){
            if($(this).val()==""){
                $(this).parents(".uploader").find(".filename").val("请选择图片...");
            }
        });

    });



    function save() {

        var type = $("#tId").val();

        var arr1 = [];
        arr1.push(UE.getEditor('editor1').getContentTxt());

        var arr2 = [];
        arr2.push(UE.getEditor('editor2').getContentTxt());

        $.post("${basePath}/htmlText/addHtmlText1",{
            contentText : arr1.join("\n"),
            contentHtml : UE.getEditor('editor1').getContent(),
            activityDetail : UE.getEditor('editor1').getContent(),
            type : 4,
            state : 0
        }).success(function (data) {
            if (data.success) {
                $("#noticeId").val(data.obj);
                $.post("${basePath}/htmlText/addHtmlText2",{
                    contentText : arr2.join("\n"),
                    contentHtml : UE.getEditor('editor2').getContent(),
                    activityDetail : UE.getEditor('editor2').getContent(),
                    type : 4,
                    state : 0
                }).success(function (data) {
                    if (data.success) {
                        $("#detailsId").val(data.obj);
                        $('#typeId').removeAttr("disabled");
                        var imgUrl = $(".imgUrl").attr("src");
                        $("#pictureUrl").val(imgUrl);

                        if ($("#name").val() == null || $("#name").val() == '') {
                            alert("请填写名称!");
                            return;
                        }
                        if ($("#nameEn").val() == null || $("#nameEn").val() == '') {
                            alert("请填写英文名称!");
                            return;
                        }
                        if ($("#visitorsDescribe").val() == null || $("#visitorsDescribe").val() == '') {
                            alert("请填写简介!");
                            return;
                        }
                        if ($("#price").val() == null || $("#price").val() == '') {
                            alert("请填写原价!");
                            return;
                        }
                        if ($("#newPrice").val() == null || $("#newPrice").val() == '') {
                            alert("请填写折后价!");
                            return;
                        }
                        if ($("#address").val() == null || $("#address").val() == '') {
                            alert("请填写地址!");
                            return;
                        }
                        if ($("#latitude").val() == null || $("#latitude").val() == '') {
                            alert("请获取经纬度!");
                            return;
                        }
                        if (type ==4 || type ==5) {
                            if ($("#integral").val() == null || $("#integral").val() == '') {
                                alert("请填写积分!");
                                return;
                            }
                        }
                        if ($("#deliverFee").val() == null || $("#deliverFee").val() == '') {
                            alert("请填写配送费!");
                            return;
                        }
                        if ($("#number").val() == null || $("#number").val() == '') {
                            alert("请填写人数!");
                            return;
                        }
                        if ($("#select").val() == null || $("#select").val() == '') {
                            alert("请选择满意度!");
                            return;
                        }
                        if ($("#startValid").datebox("getValue") == null || $("#startValid").datebox("getValue") == '') {
                            alert("请选择开启时间!");
                            return;
                        }
                        if ($("#endValid").datebox("getValue") == null || $("#endValid").datebox("getValue") == '') {
                            alert("请选择关闭时间!");
                            return;
                        }
                        if ($(".imgUrl").attr("src") == null || $(".imgUrl").attr("src") == '') {
                            alert("请上传主图!");
                            return;
                        }
                        if ($("#noticeId").val() == null || $("#noticeId").val() == '') {
                            alert("请填写须知!");
                            return;
                        }
                        if ($("#detailsId").val() == null || $("#detailsId").val() == '') {
                            alert("请填写详情!");
                            return;
                        }

                        $('#ff').submit();
                    } else {
                        eu.showMsg(data);
                    }
                }).error(function (data) {
                    eu.showMsg("系统错误，请联系管理员！");
                })
            } else {
                eu.showMsg(data);
            }
        }).error(function (data) {
            eu.showMsg("系统错误，请联系管理员！");
        })

	}

    function uploadImg() {
        var formElement = document.getElementById("ff");
        var oRep = new XMLHttpRequest();
        oRep.open("POST","${basePath}/background/visitorsManage/uploadPicture",true);
        oRep.send(new FormData(formElement));
        oRep.onreadystatechange = function() {
            if (oRep.readyState == 4) {
                var b = oRep.responseText;
                var a = eval("("+b+")");
                console.log(a.obj);
                if (oRep.status == 200) {
                    if (a.success == true) {
                        $("#pictureId").html("<img class='imgUrl' src='"+a.obj+"'>");
                        /*for (var i = 0 ; i < a.obj.length ; i++){
                            var position = a.obj[i];
                            for(var pro in position){
                                $("#pictureId").append("<div style='float: left;'>" +
                                        "<img class='imgUrl' src='"+position[pro]+"'>" +
                                        "<img src='${ctx}/images/xhao.png' style='width: 10px;height: 10px;vertical-align: top; margin-left: -10px;' onclick='deleteImg(this)'>" +
                                        "</div>");
                            }
                        }*/
                    }
                }
            }
        }
    }

    function latAndLong(){
        $(".latAndLong").css('display','block');
    }

    function openNew(){
        var lat = $("#latitude").val();
        var lon = $("#longitude").val();
        if(lat == null || lat.length == 0){
            lat = 118.449347
        }
        if(lon == null || lon.length == 0){
            lon = 39.272507
        }
        var map = new AMap.Map("initMap",{
            resizeEnable: true,
            center: [lat,lon]
        });
        var marker = new AMap.Marker({
            position : [ lat, lon ]
        });
        marker.setMap(map);
        map.addControl(new AMap.ToolBar())
        map.setFitView()
        map.on('click', function(e) {
            map.clearMap();
            //经度
            document.getElementById("lat").value = e.lnglat.getLng();
            //纬度
            document.getElementById("lon").value = e.lnglat.getLat();

            var lat1 = $("#lat").val();
            var lon1 = $("#lon").val();
            var marker = new AMap.Marker({
                position : [ lat1, lon1 ]
            });
            marker.setMap(map);
            map.addControl(new AMap.ToolBar())
        });
        $('#mapWindow').window('open');
    }


    function saveJW() {
        var lat = $('#lat').val();
        var lon = $('#lon').val();
        if (lat == "" || lon == "") {
            alert("请选择经纬度！");
            return false;
        }
        $("#latitude").val(lat);
        $("#longitude").val(lon);
        $('#mapWindow').window('close');
    }
    function closeJW() {
        $('#mapWindow').window('close');
    }



</script>

<!-- <div id="ImgWindow" class="easyui-window" title="图片查看" data-options="closed:true,inline:true"
	style="width: 420px; height: 380px; padding: 5px;">
	<div class="easyui-layout" data-options="fit:true">
		<div data-options="region:'center'" style="padding: 10px;">
				<p>
					<img alt="图片暂时无法显示" style="width: 350px;height: auto" src="" id="showImg">
				</p>
		</div>
		<div data-options="region:'south',border:false" style="text-align: right; padding: 5px 0 0;">
			<a class="easyui-linkbutton" data-options="iconCls:'icon-cancel'" href="javascript:void(0)" onclick="$('#ImgWindow').window('close');">关闭</a>
		</div>
	</div>
</div> -->
<%@ include file="/WEB-INF/views-commons/footer.jsp"%>