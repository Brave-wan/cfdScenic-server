var visitorsManager = {
		delUrl : "./background/visitorsManage/deleteVisitors",
		ylUrl  : "./background/visitorsManage/showPage",
		init : function(){
			$(window).load(function(){
				$('#visitorsGid').datagrid({
					url:'./visitorsOrder/getVisitorsOrderWeiList.json',
					border:false,
					fit:true,
					singleSelect:true,
					idField:'id',
					pagination:true,
					pageSize:20,
					striped:true,
					fitColumns:true,
					columns : [ [ {
						field : 'id',
						title : 'id',
						align:'center',width:100,hidden:true

					},{
						field : 'order_code',
						title : '订单号',
						align:'center',width:100
					},{
						field : 'user_name',
						title : '订票人',
						align:'center',width:100
					},{
						field : 'v_name',
						title : '景区名称',
						align:'center',width:100
					},{
						field : 'price',
						title : '原价',
						align:'center',width:100
					},{
						field : 'real_price',
						title : '总价',
						align:'center',width:100
					},{
						field : 'order_state',
						title : '订单状态',
						align:'center',width:100
					},{
						field : 'invoice_state',
						title : '发票状态',
						align:'center',width:100
					}] ]
				});
			});
		},
		
		show : function(url) {
			var arr = new Array();
			arr = url.split(",");
			console.log(url);
			$('#ImgWindow').window('open');
			$('#imgId').val(arr[0]);
			$('#selectType').val(arr[2]);
			$('#showImg').attr('src', arr[1]);
		},
		
		add : function(){
			$('#visitorsWindow').window('open');
			$('#visitorsForm').form('clear');
			$('#id').val(0);
		},
		
		addSub : function(){
			var a = visitorsManager.addUrl;
			/*if($('#imgFile').val() == null || $('#imgFile').val() == ''){
				a = bankListManager.subUrl1;
			}*/
			var formElement = document.getElementById("visitorsForm");
			var oReq = new XMLHttpRequest();
			$.messager.progress({
				title : '提示信息',
				msg : '请稍候...',
				interval : 2000
			});
			oReq.open("POST", a, true);
			oReq.send(new FormData(formElement));
			oReq.onreadystatechange = function() {
				if (oReq.readyState == 4) {
					console.log(oReq.status);
					if (oReq.status == 200) {
						var b = oReq.responseText;
						console.log(b);
						if (b == "success") {
							$.messager.progress('close');
							$('#visitorsWindow').window('close');
							$('#visitorsGid').datagrid('reload');
						} else {
							$.messager.progress('close');
							eu.showMsg("失败");
						}
					} else {
						$.messager.progress('close');
						eu.showMsg("失败");
					}
				}
			}
		},
		
		edit : function() {
			var row = $('#visitorsGid').datagrid('getSelected');
			if (!row) {
				eu.showMsg("请选择一行再进行操作");
				return;
			}
			console.log(row);
			$('#ImageSubWindow').window('open');
			$('#uploadForm').form('clear');
			$('#ImgId').val(row.id);
//			$('#searchValue').combobox('setValue',row.status);
			$('#upName').val(row.name);
			$('#imgSrcId').attr('src',row.headImg);
		},
		
		submit : function(){
			var a = visitorsManager.addUrl;
			/*if($('#imgFile').val() == null || $('#imgFile').val() == ''){
				a = bankListManager.subUrl1;
			}*/
			var formElement = document.getElementById("uploadForm");
			var oReq = new XMLHttpRequest();
			$.messager.progress({
				title : '提示信息',
				msg : '请稍候...',
				interval : 2000
			});
			oReq.open("POST", a, true);
			oReq.send(new FormData(formElement));
			oReq.onreadystatechange = function() {
				if (oReq.readyState == 4) {
					console.log(oReq.status);
					if (oReq.status == 200) {
						var b = oReq.responseText;
						console.log(b);
						if (b == "success") {
							$.messager.progress('close');
							$('#ImageSubWindow').window('close');
							$('#visitorsGid').datagrid('reload');
						} else {
							$.messager.progress('close');
							eu.showMsg("失败");
						}
					} else {
						$.messager.progress('close');
						eu.showMsg("失败");
					}
				}
			}
		},
		
		serch : function(){
			var orderCode =  $("#searchValue1").val();
			$('#visitorsGid').datagrid('load',{orderCode: orderCode});
			$('#visitorsGid').datagrid('clearSelections');
		},
		
		del : function() {
			var row = $('#visitorsGid').datagrid('getSelected');
			if (!row) {
				eu.showMsg("请选择一行再进行操作");
				return;
			}
			$.messager.confirm("提示信息", "您确定要将该数据删除吗？", function(r) {
				if (r) {
					$.post(visitorsManager.delUrl, {
						id : row.id
					}).success(function(data) {
						if (data.success) {
							eu.showMsg("操作成功！");
							$("#visitorsGid").datagrid('reload');
						} else {
							eu.showMsg(data);
						}
					}).error(function(data) {
						eu.showMsg("系统错误，请联系管理员！");
					})
				} else {
					$('#visitorsGid').datagrid('clearSelections');
				}
			});
		},
		
		yl : function(){
			var row = $("#visitorsGid").datagrid('getSelected');
			if(!row){
				eu.showMsg("请选择一行再进行操作");
				return;
			}
			window.location.href = visitorsManager.ylUrl+"?id="+row.id;
		}
};
visitorsManager.init();