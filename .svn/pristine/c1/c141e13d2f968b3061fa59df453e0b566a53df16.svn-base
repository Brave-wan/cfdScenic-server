package com.htkj.cfdScenic.app.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import com.alibaba.fastjson.JSONObject;
import com.alibaba.fastjson.serializer.SerializerFeature;
import com.htkj.cfdScenic.app.model.VisitorsOrder;
import com.htkj.cfdScenic.app.service.VisitorsOrderService;
import com.htkj.cfdScenic.app.util.ResponseMsg;
import com.htrj.common.base.BaseController;
import com.htrj.common.utils.GenerateSequenceUtil;

@Controller
@RequestMapping("/visitorsOrder")
public class VisitorsOrderController extends BaseController{
	@Autowired
	private VisitorsOrderService visitorsOrderService;
	
	/*
	 * 景区-确认订单
	 * POST
	 * http://localhost:8080/cfdScenic/VisitorsOrder/affirmOrder
	 * 把景区传过来的值存进表
		name 				//订单名称
		orderDescribe 		//订单描述
		price 				//原价
		startValid 			//开始有效期
		endValid 			//结束有效期
		quantity 			//数量
		userId 				//用户id
		realPrice 			//应付价格
		visitorsId 			//景点id
	 */
	@RequestMapping(value="/affirmOrder",produces="text/html;charset=UTF-8")
	@ResponseBody
	public String affirmOrder(VisitorsOrder visitorsOrder){
		ResponseMsg msg = new ResponseMsg();
		String json = new String();
		try {
			visitorsOrder.setId(GenerateSequenceUtil.getUniqueId());
			visitorsOrder.setPayState(0);
			visitorsOrder.setOrderState(1);
			visitorsOrderService.insertMessage(visitorsOrder);
			msg.setHearder(0, "success");
		} catch (Exception e) {
			msg.setHearder(1, "error");
		}
		json = JSONObject.toJSONString(msg,SerializerFeature.WriteMapNullValue);
		System.out.println(json);
		return json;
	}
}
